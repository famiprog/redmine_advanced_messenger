<%= javascript_tag do %>
// We need to enclose the code in a block {} because otherwise we get a javascript compilation error about variables/constants being declared many times
{
    var currentNote = $("#change-" + <%= journal.id %> + ".journal.has-notes");
    if (currentNote.length != 0) {
        renderPluginForMessage("<%= journal.id %>", 
                                    <%= journal.read_by_users.html_safe %>,
                                    "<%= journal.notes.nil? ? '' : escape_javascript(journal.notes[0, 50])  %>", 
                                    "<%=format_time(journal.created_on)%>", 
                                    currentNote, ".note-header", ".wiki", "update_journal_read_by_users", 
                                    ...<%= raw(getUsersReadStatus(journal.read_by_users).to_json)%>);
    }
}
<% end %>
